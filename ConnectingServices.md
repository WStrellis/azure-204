Four services for managing communication  between services:  
- Storage Queue
- Event Grid
- Event Hub
- Service Bus

## Message-based Service
- Sender requires receiver to do something with the message
- The message includes data as well as information about the event that created the data
- Supports transactions for groups of messages

*Message Delivery Strategies*
- At-Least-Once Delivery : Each message in the queue is guaranteed to be delivered to at least one Receiver. However, this makes it possible for a Receiver to get duplicate messages. App code needs to watch for duplicate messages.
- At-Most-Once Delivery : Messages may not be read by a Receiver, but duplicates are not possible.
- FIFO : Use a queue system with a FIFO guarantee.

### Queue Storage
- Simple, easy to setup
- supports queue size greater than 80gb
- stores messages sent from Providers until a Subscriber reads them

## Service Bus

*namespace* - a container with a FQDN that with the queues, topics, and relays for a Service Bus instance.

Each namespace has encryrtion keys. Sending and Receiving components must provide these keys when connecting.


### Service Bus Queues
- supports transactions, At-Most-Once delivery, batching messages, FIFO guarantee, RBAC
- pricing based on queue size. Charged for each message added or removed from queue.
- messages are limited to 64kb. To use larger amounts of data, first store the message as a Blob, and send the URL to the data in the message. 
- When a receiver reads a message from the queue the message is becomes invisible to other receivers for 30 seconds. If the receiver sucessfully processes the message it will delete the message from the queue. If the receiver fails to process the message and delete it, the message will become visible again to other receivers.

Information required to access a queue:
- storage account name
- queue name
- auth token

*Queue Access*
Azure AD - RBAC using Azure AD  
Shared Key - An encrypted signature associated with a storage account.  Grants full access to storage account.  
Shared Access Signature( SAS ) - a generated URI. Configurable for specific permissions.

### Service Bus Topics
- suports "Topics", allowing multiple Receivers to handle each message

*Queues*  
A temporary storage object that acts as an intermediary between one Send and and one Receiver. 

*Topics*  
Similar to a Queue but each message in the Topic can be sent to multiple Receivers.

*Relay*  
Used to simulate a direct communication between the Sender and Reciever as if they were on the same network segment but separated by a firewall.

*Subscription Filter Types*  
Boolean - `TrueFilter` all messages sent to topic are delivered to subscribers. `FalseFilter` no messages sent to topic are delivered.  
SQL - Uses a filter condition written in SQL syntax to evaluate incoming messages to a topic. Only messages that evaluate to True are delivered. Highest processing time.  
Correlation - List of k:v conditions. If the properties and values match the message is delivered.



## Event-based Service
- Sender does not have any expectation that the Receiver will process or perform an action on the event
- Event only includes information about the event that occurred, no data that might have been generated by the event

### Azure Event Grid Service
The event `Source/ Publisher` sends events to the EG. The event is assigned a `topic`. EG then sends the event to `Handlers` who are listening for that topic.  

Basic Concepts:  
- Event : what happened
- Event Source: where the event occured. Related to an Event Type
- Topic: endpoint of the EG that the `Source` sends events to
- Event Subscriptions: Endpoint or function on EG that filters events to correct Handler
- Event Handlers: The app or service reacting to the event

Structure of an Event:
```
  {
    "topic": string - The full resource path to the event source. Event Grid provides this value.,
    "subject": string - Publisher-defined path to the event subject.,
    "id": string,
    "eventType": string,
    "eventTime": string,
    "data":{
      object-unique-to-each-publisher
      this field is optional
    },
    "dataVersion": string,
    "metadataVersion": string
  }
```

*Event Subscription*  
- defineds which events on a topic a Handler wants to receive. The subscription can filter events on their type or subject.
*Event Topics*  
- System Topics
    + topics provided by Azure. Not visible in subscription list, but can be subscribed to by handlerrs if access is available
- Custom Topics
    + topics created by you or third parties. Visible in subscription list.

The following services can operate as event handlers to EG:
- Azure Functions
- Webhooks
- Azure Logic Apps
- Microsoft Power Automate

### Azure Event Hub Service
EH is designed for streaming events and massive amounts of data.
- Events are store in `Partitions` for 24 hours( default ) before expiring. Allows Subscriber to be offline or busy and catch up later.
- Can immediately send events to Data Lake or Blob Storage.
- All publishers are authenticated and given a token

Reasons to choose over Event Grid:  
- need to support large number of publishers sending a data stream
- need to stream data to Data Lake or Blob Storage
- need aggregation or analytics on data stream
- need high reliablity or resiliency